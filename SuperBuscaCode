/**
 * Configura√ß√£o da Super Busca
 */
const SUPER_BUSCA_CONFIG = {
  SOURCE_SHEET: '5.COST.LIST', // Nome exato da aba de origem
  SOURCE_COL: 6, // Coluna F = 6 (A=1, B=2...)
  MENU_TITLE: 'üîç Super Busca'
};

function onOpen() {
  SpreadsheetApp.getUi()
    .createMenu(SUPER_BUSCA_CONFIG.MENU_TITLE)
    .addItem('üöÄ Abrir Painel', 'abrirSuperBuscaSidebar')
    .addToUi();
}

function abrirSuperBuscaSidebar() {
  const html = HtmlService.createHtmlOutputFromFile('SuperBuscaSidebar')
    .setTitle('Busca de Materiais')
    .setWidth(350);
  SpreadsheetApp.getUi().showSidebar(html);
}

/**
 * Pega os dados da lista de custos para a mem√≥ria do Sidebar
 */
function getDadosParaBusca() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName(SUPER_BUSCA_CONFIG.SOURCE_SHEET);
  
  if (!sheet) return []; // Retorna vazio se a aba n√£o existir

  const lastRow = sheet.getLastRow();
  if (lastRow < 2) return [];

  // Pega valores da coluna configurada
  const values = sheet.getRange(2, SUPER_BUSCA_CONFIG.SOURCE_COL, lastRow - 1, 1).getDisplayValues();
  
  // Limpa vazios e duplicatas para deixar a busca mais leve
  const listaLimpa = values.flat().filter(item => item !== "");
  return [...new Set(listaLimpa)]; // Remove duplicatas
}

/**
 * Insere os itens na c√©lula ATIVA (onde o cursor do usu√°rio est√°)
 */
function inserirItensSelecionados(itens) {
  if (!itens || itens.length === 0) return;

  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getActiveSheet();
  const activeCell = sheet.getActiveCell();
  
  const row = activeCell.getRow();
  const col = activeCell.getColumn();

  // Prepara o array vertical
  const dadosParaInserir = itens.map(item => [item]);

  // Insere sobrescrevendo para baixo a partir da c√©lula ativa
  sheet.getRange(row, col, dadosParaInserir.length, 1).setValues(dadosParaInserir);
  
  // Move a sele√ß√£o para a pr√≥xima c√©lula livre abaixo, facilitando inser√ß√µes cont√≠nuas
  const nextRow = row + dadosParaInserir.length;
  sheet.getRange(nextRow, col).activate();
}
